"use strict";angular.module("rtsngApp",["ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{token:function(){return TokenHandler.get()}}}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){var b=["$rootScope","$location","$q",function(a,b,c){var d=function(a){return a},e=function(b){if(401===b.status){var d=c.defer();return a.$broadcast("event:unauthorized"),d.promise}return c.reject(b)};return function(a){return a.then(d,e)}}];a.responseInterceptors.push(b)}]).run(["$rootScope","$http","$location",function(a,b,c){a.$on("event:unauthorized",function(){c.path("/login")})}]),angular.module("rtsngApp").controller("MainCtrl",["$rootScope","$scope","$http",function(a,b){b.currentUser={}}]),angular.module("rtsngApp").controller("LoginCtrl",["$rootScope","$location","$scope","$http","TokenHandlerService",function(a,b,c,d,e){c.signup=function(){d({url:"/api/users",method:"POST",data:{user:c.user}}).success(function(a){e.set(a.auth_token),c.$broadcast("event:authenticated"),b.path("/")}).error(function(a){c.user.errors=a})},c.login=function(){d({url:"/api/users/sign_in",method:"POST",data:{user:c.user}}).success(function(a){a.success?(c.ngModel=a.data.data,alert("test"),e.set(a.data.auth_token),b.path("/")):(c.ngModel=a,c.user.errors=a.info)})}}]),angular.module("rtsngApp").factory("TokenHandlerService",["$http","$q",function(a,b){var c,d=null,e={set:function(a){d=a},get:function(){return d?d:($rootScope.$broadcast("event:unauthorized"),void 0)},getCurrentUser:function(){var d=b.defer();return c?d.resolve(c):a({url:"/api/current_user",method:"POST"}).then(function(a){d.resolve(a.data)}),d.promise},wrapActions:function(a,b){for(var c=a,d=0;d<b.length;d++)f(c,b[d]);return c}},f=function(a,b){a["_"+b]=a[b],a[b]=function(c,d,e){return a["_"+b](angular.extend({},c||{},{access_token:tokenHandler.get()}),d,e)}};return e}]);